'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.SYNTHETIC = undefined;
exports.isLocSexp = isLocSexp;
exports.isParamsSexp = isParamsSexp;
exports.isHashSexp = isHashSexp;
exports.normalizeModifier = normalizeModifier;
exports.normalizeAttr = normalizeAttr;
exports.normalizeHash = normalizeHash;
exports.normalizePath = normalizePath;
exports.normalizeElementOptions = normalizeElementOptions;

var _util = require('@glimmer/util');

function buildMustache(path, params, hash, raw, loc) {
    if (typeof path === 'string') {
        path = buildPath(path);
    }
    return {
        type: 'MustacheStatement',
        path: path,
        params: params || [],
        hash: hash || buildHash([]),
        escaped: !raw,
        loc: buildLoc(loc || null)
    };
}
function buildBlock(path, params, hash, _defaultBlock, _elseBlock, loc) {
    var defaultBlock = void 0;
    var elseBlock = void 0;
    if (_defaultBlock.type === 'Template') {
        if (false) {
            false && !false && (0, _util.deprecate)('b.program is deprecated. Use b.blockItself instead.');
        }
        defaultBlock = (0, _util.assign)({}, _defaultBlock, { type: 'Block' });
    } else {
        defaultBlock = _defaultBlock;
    }
    if (_elseBlock !== undefined && _elseBlock !== null && _elseBlock.type === 'Template') {
        if (false) {
            false && !false && (0, _util.deprecate)('b.program is deprecated. Use b.blockItself instead.');
        }
        elseBlock = (0, _util.assign)({}, _elseBlock, { type: 'Block' });
    } else {
        elseBlock = _elseBlock;
    }
    return {
        type: 'BlockStatement',
        path: buildPath(path),
        params: params || [],
        hash: hash || buildHash([]),
        program: defaultBlock || null,
        inverse: elseBlock || null,
        loc: buildLoc(loc || null)
    };
}
function buildElementModifier(path, params, hash, loc) {
    return {
        type: 'ElementModifierStatement',
        path: buildPath(path),
        params: params || [],
        hash: hash || buildHash([]),
        loc: buildLoc(loc || null)
    };
}
function buildPartial(name, params, hash, indent, loc) {
    return {
        type: 'PartialStatement',
        name: name,
        params: params || [],
        hash: hash || buildHash([]),
        indent: indent || '',
        strip: { open: false, close: false },
        loc: buildLoc(loc || null)
    };
}
function buildComment(value, loc) {
    return {
        type: 'CommentStatement',
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildMustacheComment(value, loc) {
    return {
        type: 'MustacheCommentStatement',
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildConcat(parts, loc) {
    return {
        type: 'ConcatStatement',
        parts: parts || [],
        loc: buildLoc(loc || null)
    };
}
function isLocSexp(value) {
    return Array.isArray(value) && value.length === 2 && value[0] === 'loc';
}
function isParamsSexp(value) {
    return Array.isArray(value) && !isLocSexp(value);
}
function isHashSexp(value) {
    if (typeof value === 'object' && value && !Array.isArray(value)) {
        expectType(value);
        return true;
    } else {
        return false;
    }
}
function expectType(_input) {
    return;
}
function normalizeModifier(sexp) {
    if (typeof sexp === 'string') {
        return buildElementModifier(sexp);
    }
    var path = normalizePath(sexp[0]);
    var params = void 0;
    var hash = void 0;
    var loc = null;
    var parts = sexp.slice(1);
    var next = parts.shift();
    // tslint:disable-next-line:label-position
    process: {
        if (isParamsSexp(next)) {
            params = next;
        } else {
            break process;
        }
        next = parts.shift();
        if (isHashSexp(next)) {
            hash = normalizeHash(next);
        } else {
            break process;
        }
    }
    if (isLocSexp(next)) {
        loc = next[1];
    }
    return buildElementModifier(path, params, hash, loc);
}
function normalizeAttr(sexp) {
    var name = sexp[0];
    var value = void 0;
    if (typeof sexp[1] === 'string') {
        value = buildText(sexp[1]);
    } else {
        value = sexp[1];
    }
    var loc = sexp[2] ? sexp[2][1] : undefined;
    return buildAttr(name, value, loc);
}
function normalizeHash(hash, loc) {
    var pairs = [];
    Object.keys(hash).forEach(function (key) {
        pairs.push(buildPair(key, hash[key]));
    });
    return buildHash(pairs, loc);
}
function normalizePath(path) {
    if (typeof path === 'string') {
        return buildPath(path);
    } else {
        return buildPath(path[1], path[2] && path[2][1]);
    }
}
function normalizeElementOptions() {
    var out = {};

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
    }

    for (var _iterator = args, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
        var _ref;

        if (_isArray) {
            if (_i >= _iterator.length) break;
            _ref = _iterator[_i++];
        } else {
            _i = _iterator.next();
            if (_i.done) break;
            _ref = _i.value;
        }

        var arg = _ref;

        switch (arg[0]) {
            case 'attrs':
                {
                    var rest = arg.slice(1);

                    out.attrs = rest.map(normalizeAttr);
                    break;
                }
            case 'modifiers':
                {
                    var _rest = arg.slice(1);

                    out.modifiers = _rest.map(normalizeModifier);
                    break;
                }
            case 'body':
                {
                    var _rest2 = arg.slice(1);

                    out.children = _rest2;
                    break;
                }
            case 'comments':
                {
                    var _rest3 = arg.slice(1);

                    out.comments = _rest3;
                    break;
                }
            case 'as':
                {
                    var _rest4 = arg.slice(1);

                    out.blockParams = _rest4;
                    break;
                }
            case 'loc':
                {
                    var _rest5 = arg[1];

                    out.loc = _rest5;
                    break;
                }
        }
    }
    return out;
}
function buildElement(tag, options) {
    var normalized = void 0;
    if (Array.isArray(options)) {
        for (var _len2 = arguments.length, rest = Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {
            rest[_key2 - 2] = arguments[_key2];
        }

        normalized = normalizeElementOptions.apply(undefined, [options].concat(rest));
    } else {
        normalized = options || {};
    }
    var _normalized = normalized,
        attrs = _normalized.attrs,
        blockParams = _normalized.blockParams,
        modifiers = _normalized.modifiers,
        comments = _normalized.comments,
        children = _normalized.children,
        loc = _normalized.loc;
    // this is used for backwards compat, prior to `selfClosing` being part of the ElementNode AST

    var selfClosing = false;
    if (typeof tag === 'object') {
        selfClosing = tag.selfClosing;
        tag = tag.name;
    } else {
        if (tag.slice(-1) === '/') {
            tag = tag.slice(0, -1);
            selfClosing = true;
        }
    }
    return {
        type: 'ElementNode',
        tag: tag || '',
        selfClosing: selfClosing,
        attributes: attrs || [],
        blockParams: blockParams || [],
        modifiers: modifiers || [],
        comments: comments || [],
        children: children || [],
        loc: buildLoc(loc || null)
    };
}
function buildAttr(name, value, loc) {
    return {
        type: 'AttrNode',
        name: name,
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildText(chars, loc) {
    return {
        type: 'TextNode',
        chars: chars || '',
        loc: buildLoc(loc || null)
    };
}
// Expressions
function buildSexpr(path, params, hash, loc) {
    return {
        type: 'SubExpression',
        path: buildPath(path),
        params: params || [],
        hash: hash || buildHash([]),
        loc: buildLoc(loc || null)
    };
}
function buildPath(original, loc) {
    if (typeof original !== 'string') return original;
    var parts = original.split('.');
    var thisHead = false;
    if (parts[0] === 'this') {
        thisHead = true;
        parts = parts.slice(1);
    }
    return {
        type: 'PathExpression',
        original: original,
        this: thisHead,
        parts: parts,
        data: false,
        loc: buildLoc(loc || null)
    };
}
function buildLiteral(type, value, loc) {
    return {
        type: type,
        value: value,
        original: value,
        loc: buildLoc(loc || null)
    };
}
// Miscellaneous
function buildHash(pairs, loc) {
    return {
        type: 'Hash',
        pairs: pairs || [],
        loc: buildLoc(loc || null)
    };
}
function buildPair(key, value, loc) {
    return {
        type: 'HashPair',
        key: key,
        value: value,
        loc: buildLoc(loc || null)
    };
}
function buildProgram(body, blockParams, loc) {
    return {
        type: 'Template',
        body: body || [],
        blockParams: blockParams || [],
        loc: buildLoc(loc || null)
    };
}
function buildBlockItself(body, blockParams) {
    var chained = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    var loc = arguments[3];

    return {
        type: 'Block',
        body: body || [],
        blockParams: blockParams || [],
        chained: chained,
        loc: buildLoc(loc || null)
    };
}
function buildTemplate(body, blockParams, loc) {
    return {
        type: 'Template',
        body: body || [],
        blockParams: blockParams || [],
        loc: buildLoc(loc || null)
    };
}
function buildSource(source) {
    return source || null;
}
function buildPosition(line, column) {
    return {
        line: line,
        column: column
    };
}
var SYNTHETIC = exports.SYNTHETIC = {
    source: '(synthetic)',
    start: { line: 1, column: 0 },
    end: { line: 1, column: 0 }
};
function buildLoc() {
    for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
        args[_key3] = arguments[_key3];
    }

    if (args.length === 1) {
        var loc = args[0];
        if (loc && typeof loc === 'object') {
            return {
                source: buildSource(loc.source),
                start: buildPosition(loc.start.line, loc.start.column),
                end: buildPosition(loc.end.line, loc.end.column)
            };
        } else {
            return SYNTHETIC;
        }
    } else {
        var startLine = args[0],
            startColumn = args[1],
            endLine = args[2],
            endColumn = args[3],
            source = args[4];

        return {
            source: buildSource(source),
            start: buildPosition(startLine, startColumn),
            end: buildPosition(endLine, endColumn)
        };
    }
}
exports.default = {
    mustache: buildMustache,
    block: buildBlock,
    partial: buildPartial,
    comment: buildComment,
    mustacheComment: buildMustacheComment,
    element: buildElement,
    elementModifier: buildElementModifier,
    attr: buildAttr,
    text: buildText,
    sexpr: buildSexpr,
    path: buildPath,
    concat: buildConcat,
    hash: buildHash,
    pair: buildPair,
    literal: buildLiteral,
    program: buildProgram,
    blockItself: buildBlockItself,
    template: buildTemplate,
    loc: buildLoc,
    pos: buildPosition,
    string: literal('StringLiteral'),
    boolean: literal('BooleanLiteral'),
    number: literal('NumberLiteral'),
    undefined: function (_undefined) {
        function undefined() {
            return _undefined.apply(this, arguments);
        }

        undefined.toString = function () {
            return _undefined.toString();
        };

        return undefined;
    }(function () {
        return buildLiteral('UndefinedLiteral', undefined);
    }),
    null: function _null() {
        return buildLiteral('NullLiteral', null);
    }
};

function literal(type) {
    return function (value) {
        return buildLiteral(type, value);
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC9saWIvYnVpbGRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O1FBeUtNLFMsR0FBQSxTO1FBSUEsWSxHQUFBLFk7UUFJQSxVLEdBQUEsVTtRQWFBLGlCLEdBQUEsaUI7UUFxQ0EsYSxHQUFBLGE7UUFlQSxhLEdBQUEsYTtRQVVBLGEsR0FBQSxhO1FBUUEsdUIsR0FBQSx1Qjs7OztBQXpQTixTQUFBLGFBQUEsQ0FBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLElBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxFQUswQjtBQUV4QixRQUFJLE9BQUEsSUFBQSxLQUFKLFFBQUEsRUFBOEI7QUFDNUIsZUFBTyxVQUFQLElBQU8sQ0FBUDtBQUNEO0FBRUQsV0FBTztBQUNMLGNBREssbUJBQUE7QUFBQSxjQUFBLElBQUE7QUFHTCxnQkFBUSxVQUhILEVBQUE7QUFJTCxjQUFNLFFBQVEsVUFKVCxFQUlTLENBSlQ7QUFLTCxpQkFBUyxDQUxKLEdBQUE7QUFNTCxhQUFLLFNBQVMsT0FBVCxJQUFBO0FBTkEsS0FBUDtBQVFEO0FBRUQsU0FBQSxVQUFBLENBQUEsSUFBQSxFQUFBLE1BQUEsRUFBQSxJQUFBLEVBQUEsYUFBQSxFQUFBLFVBQUEsRUFBQSxHQUFBLEVBTTBCO0FBRXhCLFFBQUEsZUFBQSxLQUFBLENBQUE7QUFDQSxRQUFBLFlBQUEsS0FBQSxDQUFBO0FBRUEsUUFBSSxjQUFBLElBQUEsS0FBSixVQUFBLEVBQXVDO0FBQ3JDLFlBQUEsS0FBQSxFQUFhO0FBQUEscUJBQUEsQ0FBQSxLQUFBLElBQUEscUJBQUEscURBQUEsQ0FBQTtBQUVaO0FBRUQsdUJBQWdCLGtCQUFBLEVBQUEsRUFBQSxhQUFBLEVBQTBCLEVBQUUsTUFBNUMsT0FBMEMsRUFBMUIsQ0FBaEI7QUFMRixLQUFBLE1BTU87QUFDTCx1QkFBQSxhQUFBO0FBQ0Q7QUFFRCxRQUFJLGVBQUEsU0FBQSxJQUE0QixlQUE1QixJQUFBLElBQW1ELFdBQUEsSUFBQSxLQUF2RCxVQUFBLEVBQXVGO0FBQ3JGLFlBQUEsS0FBQSxFQUFhO0FBQUEscUJBQUEsQ0FBQSxLQUFBLElBQUEscUJBQUEscURBQUEsQ0FBQTtBQUVaO0FBRUQsb0JBQWEsa0JBQUEsRUFBQSxFQUFBLFVBQUEsRUFBdUIsRUFBRSxNQUF0QyxPQUFvQyxFQUF2QixDQUFiO0FBTEYsS0FBQSxNQU1PO0FBQ0wsb0JBQUEsVUFBQTtBQUNEO0FBRUQsV0FBTztBQUNMLGNBREssZ0JBQUE7QUFFTCxjQUFNLFVBRkQsSUFFQyxDQUZEO0FBR0wsZ0JBQVEsVUFISCxFQUFBO0FBSUwsY0FBTSxRQUFRLFVBSlQsRUFJUyxDQUpUO0FBS0wsaUJBQVMsZ0JBTEosSUFBQTtBQU1MLGlCQUFTLGFBTkosSUFBQTtBQU9MLGFBQUssU0FBUyxPQUFULElBQUE7QUFQQSxLQUFQO0FBU0Q7QUFFRCxTQUFBLG9CQUFBLENBQUEsSUFBQSxFQUFBLE1BQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUlrQztBQUVoQyxXQUFPO0FBQ0wsY0FESywwQkFBQTtBQUVMLGNBQU0sVUFGRCxJQUVDLENBRkQ7QUFHTCxnQkFBUSxVQUhILEVBQUE7QUFJTCxjQUFNLFFBQVEsVUFKVCxFQUlTLENBSlQ7QUFLTCxhQUFLLFNBQVMsT0FBVCxJQUFBO0FBTEEsS0FBUDtBQU9EO0FBRUQsU0FBQSxZQUFBLENBQUEsSUFBQSxFQUFBLE1BQUEsRUFBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLEdBQUEsRUFLMEI7QUFFeEIsV0FBTztBQUNMLGNBREssa0JBQUE7QUFFTCxjQUZLLElBQUE7QUFHTCxnQkFBUSxVQUhILEVBQUE7QUFJTCxjQUFNLFFBQVEsVUFKVCxFQUlTLENBSlQ7QUFLTCxnQkFBUSxVQUxILEVBQUE7QUFNTCxlQUFPLEVBQUUsTUFBRixLQUFBLEVBQWUsT0FOakIsS0FNRSxFQU5GO0FBT0wsYUFBSyxTQUFTLE9BQVQsSUFBQTtBQVBBLEtBQVA7QUFTRDtBQUVELFNBQUEsWUFBQSxDQUFBLEtBQUEsRUFBQSxHQUFBLEVBQTZEO0FBQzNELFdBQU87QUFDTCxjQURLLGtCQUFBO0FBRUwsZUFGSyxLQUFBO0FBR0wsYUFBSyxTQUFTLE9BQVQsSUFBQTtBQUhBLEtBQVA7QUFLRDtBQUVELFNBQUEsb0JBQUEsQ0FBQSxLQUFBLEVBQUEsR0FBQSxFQUUwQjtBQUV4QixXQUFPO0FBQ0wsY0FESywwQkFBQTtBQUVMLGVBRkssS0FBQTtBQUdMLGFBQUssU0FBUyxPQUFULElBQUE7QUFIQSxLQUFQO0FBS0Q7QUFFRCxTQUFBLFdBQUEsQ0FBQSxLQUFBLEVBQUEsR0FBQSxFQUUwQjtBQUV4QixXQUFPO0FBQ0wsY0FESyxpQkFBQTtBQUVMLGVBQU8sU0FGRixFQUFBO0FBR0wsYUFBSyxTQUFTLE9BQVQsSUFBQTtBQUhBLEtBQVA7QUFLRDtBQWtDSyxTQUFBLFNBQUEsQ0FBQSxLQUFBLEVBQW9DO0FBQ3hDLFdBQU8sTUFBQSxPQUFBLENBQUEsS0FBQSxLQUF3QixNQUFBLE1BQUEsS0FBeEIsQ0FBQSxJQUE4QyxNQUFBLENBQUEsTUFBckQsS0FBQTtBQUNEO0FBRUssU0FBQSxZQUFBLENBQUEsS0FBQSxFQUF1QztBQUMzQyxXQUFPLE1BQUEsT0FBQSxDQUFBLEtBQUEsS0FBd0IsQ0FBQyxVQUFoQyxLQUFnQyxDQUFoQztBQUNEO0FBRUssU0FBQSxVQUFBLENBQUEsS0FBQSxFQUFxQztBQUN6QyxRQUFJLE9BQUEsS0FBQSxLQUFBLFFBQUEsSUFBQSxLQUFBLElBQXNDLENBQUMsTUFBQSxPQUFBLENBQTNDLEtBQTJDLENBQTNDLEVBQWlFO0FBQy9ELG1CQUFBLEtBQUE7QUFDQSxlQUFBLElBQUE7QUFGRixLQUFBLE1BR087QUFDTCxlQUFBLEtBQUE7QUFDRDtBQUNGO0FBRUQsU0FBQSxVQUFBLENBQUEsTUFBQSxFQUFnQztBQUM5QjtBQUNEO0FBRUssU0FBQSxpQkFBQSxDQUFBLElBQUEsRUFBOEM7QUFDbEQsUUFBSSxPQUFBLElBQUEsS0FBSixRQUFBLEVBQThCO0FBQzVCLGVBQU8scUJBQVAsSUFBTyxDQUFQO0FBQ0Q7QUFFRCxRQUFJLE9BQTJCLGNBQWMsS0FBN0MsQ0FBNkMsQ0FBZCxDQUEvQjtBQUNBLFFBQUEsU0FBQSxLQUFBLENBQUE7QUFDQSxRQUFBLE9BQUEsS0FBQSxDQUFBO0FBQ0EsUUFBSSxNQUFKLElBQUE7QUFFQSxRQUFJLFFBQVEsS0FBQSxLQUFBLENBQVosQ0FBWSxDQUFaO0FBQ0EsUUFBSSxPQUFPLE1BQVgsS0FBVyxFQUFYO0FBRUE7QUFDQSxhQUFTO0FBQ1AsWUFBSSxhQUFKLElBQUksQ0FBSixFQUF3QjtBQUN0QixxQkFBQSxJQUFBO0FBREYsU0FBQSxNQUVPO0FBQ0wsa0JBQUEsT0FBQTtBQUNEO0FBRUQsZUFBTyxNQUFQLEtBQU8sRUFBUDtBQUVBLFlBQUksV0FBSixJQUFJLENBQUosRUFBc0I7QUFDcEIsbUJBQU8sY0FBUCxJQUFPLENBQVA7QUFERixTQUFBLE1BRU87QUFDTCxrQkFBQSxPQUFBO0FBQ0Q7QUFDRjtBQUVELFFBQUksVUFBSixJQUFJLENBQUosRUFBcUI7QUFDbkIsY0FBTSxLQUFOLENBQU0sQ0FBTjtBQUNEO0FBRUQsV0FBTyxxQkFBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLElBQUEsRUFBUCxHQUFPLENBQVA7QUFDRDtBQUVLLFNBQUEsYUFBQSxDQUFBLElBQUEsRUFBc0M7QUFDMUMsUUFBSSxPQUFPLEtBQVgsQ0FBVyxDQUFYO0FBQ0EsUUFBQSxRQUFBLEtBQUEsQ0FBQTtBQUVBLFFBQUksT0FBTyxLQUFQLENBQU8sQ0FBUCxLQUFKLFFBQUEsRUFBaUM7QUFDL0IsZ0JBQVEsVUFBVSxLQUFsQixDQUFrQixDQUFWLENBQVI7QUFERixLQUFBLE1BRU87QUFDTCxnQkFBUSxLQUFSLENBQVEsQ0FBUjtBQUNEO0FBRUQsUUFBSSxNQUFNLEtBQUEsQ0FBQSxJQUFVLEtBQUEsQ0FBQSxFQUFWLENBQVUsQ0FBVixHQUFWLFNBQUE7QUFFQSxXQUFPLFVBQUEsSUFBQSxFQUFBLEtBQUEsRUFBUCxHQUFPLENBQVA7QUFDRDtBQUVLLFNBQUEsYUFBQSxDQUFBLElBQUEsRUFBQSxHQUFBLEVBQTRFO0FBQ2hGLFFBQUksUUFBSixFQUFBO0FBRUEsV0FBQSxJQUFBLENBQUEsSUFBQSxFQUFBLE9BQUEsQ0FBMEIsVUFBQSxHQUFBLEVBQU07QUFDOUIsY0FBQSxJQUFBLENBQVcsVUFBQSxHQUFBLEVBQWUsS0FBMUIsR0FBMEIsQ0FBZixDQUFYO0FBREYsS0FBQTtBQUlBLFdBQU8sVUFBQSxLQUFBLEVBQVAsR0FBTyxDQUFQO0FBQ0Q7QUFFSyxTQUFBLGFBQUEsQ0FBQSxJQUFBLEVBQXNDO0FBQzFDLFFBQUksT0FBQSxJQUFBLEtBQUosUUFBQSxFQUE4QjtBQUM1QixlQUFPLFVBQVAsSUFBTyxDQUFQO0FBREYsS0FBQSxNQUVPO0FBQ0wsZUFBTyxVQUFVLEtBQVYsQ0FBVSxDQUFWLEVBQW1CLEtBQUEsQ0FBQSxLQUFXLEtBQUEsQ0FBQSxFQUFyQyxDQUFxQyxDQUE5QixDQUFQO0FBQ0Q7QUFDRjtBQUVLLFNBQUEsdUJBQUEsR0FBd0Q7QUFDNUQsUUFBSSxNQUFKLEVBQUE7O0FBRDRELFNBQUEsSUFBQSxPQUFBLFVBQUEsTUFBQSxFQUF4RCxPQUF3RCxNQUFBLElBQUEsQ0FBQSxFQUFBLE9BQUEsQ0FBQSxFQUFBLE9BQUEsSUFBQSxFQUFBLE1BQUEsRUFBQTtBQUF4RCxhQUF3RCxJQUF4RCxJQUF3RCxVQUFBLElBQUEsQ0FBeEQ7QUFBd0Q7O0FBRzVELFNBQUEsSUFBQSxZQUFBLElBQUEsRUFBQSxXQUFBLE1BQUEsT0FBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLEtBQUEsQ0FBQSxFQUFBLFlBQUEsV0FBQSxTQUFBLEdBQUEsVUFBQSxPQUFBLFFBQUEsR0FBQSxJQUFzQjtBQUFBLFlBQUEsSUFBQTs7QUFBQSxZQUFBLFFBQUEsRUFBQTtBQUFBLGdCQUFBLE1BQUEsVUFBQSxNQUFBLEVBQUE7QUFBQSxtQkFBQSxVQUFBLElBQUEsQ0FBQTtBQUFBLFNBQUEsTUFBQTtBQUFBLGlCQUFBLFVBQUEsSUFBQSxFQUFBO0FBQUEsZ0JBQUEsR0FBQSxJQUFBLEVBQUE7QUFBQSxtQkFBQSxHQUFBLEtBQUE7QUFBQTs7QUFBQSxZQUF0QixNQUFzQixJQUFBOztBQUNwQixnQkFBUSxJQUFSLENBQVEsQ0FBUjtBQUNFLGlCQUFBLE9BQUE7QUFBYztBQUFBLHdCQUFBLE9BQUEsSUFBQSxLQUFBLENBQUEsQ0FBQSxDQUFBOztBQUVaLHdCQUFBLEtBQUEsR0FBWSxLQUFBLEdBQUEsQ0FBWixhQUFZLENBQVo7QUFDQTtBQUNEO0FBQ0QsaUJBQUEsV0FBQTtBQUFrQjtBQUFBLHdCQUFBLFFBQUEsSUFBQSxLQUFBLENBQUEsQ0FBQSxDQUFBOztBQUVoQix3QkFBQSxTQUFBLEdBQWdCLE1BQUEsR0FBQSxDQUFoQixpQkFBZ0IsQ0FBaEI7QUFDQTtBQUNEO0FBQ0QsaUJBQUEsTUFBQTtBQUFhO0FBQUEsd0JBQUEsU0FBQSxJQUFBLEtBQUEsQ0FBQSxDQUFBLENBQUE7O0FBRVgsd0JBQUEsUUFBQSxHQUFBLE1BQUE7QUFDQTtBQUNEO0FBQ0QsaUJBQUEsVUFBQTtBQUFpQjtBQUFBLHdCQUFBLFNBQUEsSUFBQSxLQUFBLENBQUEsQ0FBQSxDQUFBOztBQUdmLHdCQUFBLFFBQUEsR0FBQSxNQUFBO0FBQ0E7QUFDRDtBQUNELGlCQUFBLElBQUE7QUFBVztBQUFBLHdCQUFBLFNBQUEsSUFBQSxLQUFBLENBQUEsQ0FBQSxDQUFBOztBQUVULHdCQUFBLFdBQUEsR0FBQSxNQUFBO0FBQ0E7QUFDRDtBQUNELGlCQUFBLEtBQUE7QUFBWTtBQUFBLHdCQUFBLFNBQUEsSUFBQSxDQUFBLENBQUE7O0FBRVYsd0JBQUEsR0FBQSxHQUFBLE1BQUE7QUFDQTtBQUNEO0FBL0JIO0FBaUNEO0FBRUQsV0FBQSxHQUFBO0FBQ0Q7QUFhRCxTQUFBLFlBQUEsQ0FBQSxHQUFBLEVBQUEsT0FBQSxFQUd3QjtBQUV0QixRQUFBLGFBQUEsS0FBQSxDQUFBO0FBQ0EsUUFBSSxNQUFBLE9BQUEsQ0FBSixPQUFJLENBQUosRUFBNEI7QUFBQSxhQUFBLElBQUEsUUFBQSxVQUFBLE1BQUEsRUFOOUIsT0FNOEIsTUFBQSxRQUFBLENBQUEsR0FBQSxRQUFBLENBQUEsR0FBQSxDQUFBLENBQUEsRUFBQSxRQUFBLENBQUEsRUFBQSxRQUFBLEtBQUEsRUFBQSxPQUFBLEVBQUE7QUFOOUIsaUJBTThCLFFBQUEsQ0FOOUIsSUFNOEIsVUFBQSxLQUFBLENBTjlCO0FBTThCOztBQUMxQixxQkFBYSx3QkFBQSxLQUFBLENBQUEsU0FBQSxFQUFBLENBQUEsT0FBQSxFQUFBLE1BQUEsQ0FBYixJQUFhLENBQUEsQ0FBYjtBQURGLEtBQUEsTUFFTztBQUNMLHFCQUFhLFdBQWIsRUFBQTtBQUNEO0FBUHFCLFFBQUEsY0FBQSxVQUFBO0FBQUEsUUFBQSxRQUFBLFlBQUEsS0FBQTtBQUFBLFFBQUEsY0FBQSxZQUFBLFdBQUE7QUFBQSxRQUFBLFlBQUEsWUFBQSxTQUFBO0FBQUEsUUFBQSxXQUFBLFlBQUEsUUFBQTtBQUFBLFFBQUEsV0FBQSxZQUFBLFFBQUE7QUFBQSxRQUFBLE1BQUEsWUFBQSxHQUFBO0FBV3RCOztBQUNBLFFBQUksY0FBSixLQUFBO0FBQ0EsUUFBSSxPQUFBLEdBQUEsS0FBSixRQUFBLEVBQTZCO0FBQzNCLHNCQUFjLElBQWQsV0FBQTtBQUNBLGNBQU0sSUFBTixJQUFBO0FBRkYsS0FBQSxNQUdPO0FBQ0wsWUFBSSxJQUFBLEtBQUEsQ0FBVSxDQUFWLENBQUEsTUFBSixHQUFBLEVBQTJCO0FBQ3pCLGtCQUFNLElBQUEsS0FBQSxDQUFBLENBQUEsRUFBYSxDQUFuQixDQUFNLENBQU47QUFDQSwwQkFBQSxJQUFBO0FBQ0Q7QUFDRjtBQUVELFdBQU87QUFDTCxjQURLLGFBQUE7QUFFTCxhQUFLLE9BRkEsRUFBQTtBQUdMLHFCQUhLLFdBQUE7QUFJTCxvQkFBWSxTQUpQLEVBQUE7QUFLTCxxQkFBYSxlQUxSLEVBQUE7QUFNTCxtQkFBVyxhQU5OLEVBQUE7QUFPTCxrQkFBVyxZQVBOLEVBQUE7QUFRTCxrQkFBVSxZQVJMLEVBQUE7QUFTTCxhQUFLLFNBQVMsT0FBVCxJQUFBO0FBVEEsS0FBUDtBQVdEO0FBRUQsU0FBQSxTQUFBLENBQUEsSUFBQSxFQUFBLEtBQUEsRUFBQSxHQUFBLEVBRzBCO0FBRXhCLFdBQU87QUFDTCxjQURLLFVBQUE7QUFFTCxjQUZLLElBQUE7QUFHTCxlQUhLLEtBQUE7QUFJTCxhQUFLLFNBQVMsT0FBVCxJQUFBO0FBSkEsS0FBUDtBQU1EO0FBRUQsU0FBQSxTQUFBLENBQUEsS0FBQSxFQUFBLEdBQUEsRUFBMkQ7QUFDekQsV0FBTztBQUNMLGNBREssVUFBQTtBQUVMLGVBQU8sU0FGRixFQUFBO0FBR0wsYUFBSyxTQUFTLE9BQVQsSUFBQTtBQUhBLEtBQVA7QUFLRDtBQUVEO0FBRUEsU0FBQSxVQUFBLENBQUEsSUFBQSxFQUFBLE1BQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUkwQjtBQUV4QixXQUFPO0FBQ0wsY0FESyxlQUFBO0FBRUwsY0FBTSxVQUZELElBRUMsQ0FGRDtBQUdMLGdCQUFRLFVBSEgsRUFBQTtBQUlMLGNBQU0sUUFBUSxVQUpULEVBSVMsQ0FKVDtBQUtMLGFBQUssU0FBUyxPQUFULElBQUE7QUFMQSxLQUFQO0FBT0Q7QUFFRCxTQUFBLFNBQUEsQ0FBQSxRQUFBLEVBQUEsR0FBQSxFQUFrRTtBQUNoRSxRQUFJLE9BQUEsUUFBQSxLQUFKLFFBQUEsRUFBa0MsT0FBQSxRQUFBO0FBRWxDLFFBQUksUUFBUSxTQUFBLEtBQUEsQ0FBWixHQUFZLENBQVo7QUFDQSxRQUFJLFdBQUosS0FBQTtBQUVBLFFBQUksTUFBQSxDQUFBLE1BQUosTUFBQSxFQUF5QjtBQUN2QixtQkFBQSxJQUFBO0FBQ0EsZ0JBQVEsTUFBQSxLQUFBLENBQVIsQ0FBUSxDQUFSO0FBQ0Q7QUFFRCxXQUFPO0FBQ0wsY0FESyxnQkFBQTtBQUFBLGtCQUFBLFFBQUE7QUFHTCxjQUhLLFFBQUE7QUFBQSxlQUFBLEtBQUE7QUFLTCxjQUxLLEtBQUE7QUFNTCxhQUFLLFNBQVMsT0FBVCxJQUFBO0FBTkEsS0FBUDtBQVFEO0FBRUQsU0FBQSxZQUFBLENBQUEsSUFBQSxFQUFBLEtBQUEsRUFBQSxHQUFBLEVBRzBCO0FBRXhCLFdBQU87QUFBQSxjQUFBLElBQUE7QUFBQSxlQUFBLEtBQUE7QUFHTCxrQkFISyxLQUFBO0FBSUwsYUFBSyxTQUFTLE9BQVQsSUFBQTtBQUpBLEtBQVA7QUFNRDtBQUVEO0FBRUEsU0FBQSxTQUFBLENBQUEsS0FBQSxFQUFBLEdBQUEsRUFBbUU7QUFDakUsV0FBTztBQUNMLGNBREssTUFBQTtBQUVMLGVBQU8sU0FGRixFQUFBO0FBR0wsYUFBSyxTQUFTLE9BQVQsSUFBQTtBQUhBLEtBQVA7QUFLRDtBQUVELFNBQUEsU0FBQSxDQUFBLEdBQUEsRUFBQSxLQUFBLEVBQUEsR0FBQSxFQUErRTtBQUM3RSxXQUFPO0FBQ0wsY0FESyxVQUFBO0FBRUwsYUFGSyxHQUFBO0FBQUEsZUFBQSxLQUFBO0FBSUwsYUFBSyxTQUFTLE9BQVQsSUFBQTtBQUpBLEtBQVA7QUFNRDtBQUVELFNBQUEsWUFBQSxDQUFBLElBQUEsRUFBQSxXQUFBLEVBQUEsR0FBQSxFQUcwQjtBQUV4QixXQUFPO0FBQ0wsY0FESyxVQUFBO0FBRUwsY0FBTSxRQUZELEVBQUE7QUFHTCxxQkFBYSxlQUhSLEVBQUE7QUFJTCxhQUFLLFNBQVMsT0FBVCxJQUFBO0FBSkEsS0FBUDtBQU1EO0FBRUQsU0FBQSxnQkFBQSxDQUFBLElBQUEsRUFBQSxXQUFBLEVBSTBCO0FBQUEsUUFEeEIsVUFDd0IsVUFBQSxNQUFBLEdBQUEsQ0FBQSxJQUFBLFVBQUEsQ0FBQSxNQUFBLFNBQUEsR0FBQSxVQUFBLENBQUEsQ0FBQSxHQUoxQixLQUkwQjtBQUFBLFFBSjFCLE1BSTBCLFVBQUEsQ0FBQSxDQUFBOztBQUV4QixXQUFPO0FBQ0wsY0FESyxPQUFBO0FBRUwsY0FBTSxRQUZELEVBQUE7QUFHTCxxQkFBYSxlQUhSLEVBQUE7QUFBQSxpQkFBQSxPQUFBO0FBS0wsYUFBSyxTQUFTLE9BQVQsSUFBQTtBQUxBLEtBQVA7QUFPRDtBQUVELFNBQUEsYUFBQSxDQUFBLElBQUEsRUFBQSxXQUFBLEVBQUEsR0FBQSxFQUcwQjtBQUV4QixXQUFPO0FBQ0wsY0FESyxVQUFBO0FBRUwsY0FBTSxRQUZELEVBQUE7QUFHTCxxQkFBYSxlQUhSLEVBQUE7QUFJTCxhQUFLLFNBQVMsT0FBVCxJQUFBO0FBSkEsS0FBUDtBQU1EO0FBRUQsU0FBQSxXQUFBLENBQUEsTUFBQSxFQUFvQztBQUNsQyxXQUFPLFVBQVAsSUFBQTtBQUNEO0FBRUQsU0FBQSxhQUFBLENBQUEsSUFBQSxFQUFBLE1BQUEsRUFBbUQ7QUFDakQsV0FBTztBQUFBLGNBQUEsSUFBQTtBQUVMLGdCQUFBO0FBRkssS0FBUDtBQUlEO0FBRU0sSUFBTSxnQ0FBZ0M7QUFDM0MsWUFEMkMsYUFBQTtBQUUzQyxXQUFPLEVBQUUsTUFBRixDQUFBLEVBQVcsUUFGeUIsQ0FFcEMsRUFGb0M7QUFHM0MsU0FBSyxFQUFFLE1BQUYsQ0FBQSxFQUFXLFFBQVgsQ0FBQTtBQUhzQyxDQUF0QztBQWVQLFNBQUEsUUFBQSxHQUFnQztBQUFBLFNBQUEsSUFBQSxRQUFBLFVBQUEsTUFBQSxFQUFoQyxPQUFnQyxNQUFBLEtBQUEsQ0FBQSxFQUFBLFFBQUEsQ0FBQSxFQUFBLFFBQUEsS0FBQSxFQUFBLE9BQUEsRUFBQTtBQUFoQyxhQUFnQyxLQUFoQyxJQUFnQyxVQUFBLEtBQUEsQ0FBaEM7QUFBZ0M7O0FBQzlCLFFBQUksS0FBQSxNQUFBLEtBQUosQ0FBQSxFQUF1QjtBQUNyQixZQUFJLE1BQU0sS0FBVixDQUFVLENBQVY7QUFFQSxZQUFJLE9BQU8sT0FBQSxHQUFBLEtBQVgsUUFBQSxFQUFvQztBQUNsQyxtQkFBTztBQUNMLHdCQUFRLFlBQVksSUFEZixNQUNHLENBREg7QUFFTCx1QkFBTyxjQUFjLElBQUEsS0FBQSxDQUFkLElBQUEsRUFBOEIsSUFBQSxLQUFBLENBRmhDLE1BRUUsQ0FGRjtBQUdMLHFCQUFLLGNBQWMsSUFBQSxHQUFBLENBQWQsSUFBQSxFQUE0QixJQUFBLEdBQUEsQ0FBNUIsTUFBQTtBQUhBLGFBQVA7QUFERixTQUFBLE1BTU87QUFDTCxtQkFBQSxTQUFBO0FBQ0Q7QUFYSCxLQUFBLE1BWU87QUFBQSxZQUFBLFlBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxZQUFBLGNBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxZQUFBLFVBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxZQUFBLFlBQUEsS0FBQSxDQUFBLENBQUE7QUFBQSxZQUFBLFNBQUEsS0FBQSxDQUFBLENBQUE7O0FBRUwsZUFBTztBQUNMLG9CQUFRLFlBREgsTUFDRyxDQURIO0FBRUwsbUJBQU8sY0FBQSxTQUFBLEVBRkYsV0FFRSxDQUZGO0FBR0wsaUJBQUssY0FBQSxPQUFBLEVBQUEsU0FBQTtBQUhBLFNBQVA7QUFLRDtBQUNGO2tCQUVjO0FBQ2IsY0FEYSxhQUFBO0FBRWIsV0FGYSxVQUFBO0FBR2IsYUFIYSxZQUFBO0FBSWIsYUFKYSxZQUFBO0FBS2IscUJBTGEsb0JBQUE7QUFNYixhQU5hLFlBQUE7QUFPYixxQkFQYSxvQkFBQTtBQVFiLFVBUmEsU0FBQTtBQVNiLFVBVGEsU0FBQTtBQVViLFdBVmEsVUFBQTtBQVdiLFVBWGEsU0FBQTtBQVliLFlBWmEsV0FBQTtBQWFiLFVBYmEsU0FBQTtBQWNiLFVBZGEsU0FBQTtBQWViLGFBZmEsWUFBQTtBQWdCYixhQWhCYSxZQUFBO0FBaUJiLGlCQWpCYSxnQkFBQTtBQWtCYixjQWxCYSxhQUFBO0FBbUJiLFNBbkJhLFFBQUE7QUFvQmIsU0FwQmEsYUFBQTtBQXNCYixZQUFRLFFBdEJLLGVBc0JMLENBdEJLO0FBdUJiLGFBQVMsUUF2QkksZ0JBdUJKLENBdkJJO0FBd0JiLFlBQVEsUUF4QkssZUF3QkwsQ0F4Qks7QUFBQSxlQUFBLFVBQUEsVUFBQSxFQUFBO0FBQUEsaUJBQUEsU0FBQSxHQUFBO0FBQUEsbUJBQUEsV0FBQSxLQUFBLENBQUEsSUFBQSxFQUFBLFNBQUEsQ0FBQTtBQUFBOztBQUFBLGtCQUFBLFFBQUEsR0FBQSxZQUFBO0FBQUEsbUJBQUEsV0FBQSxRQUFBLEVBQUE7QUFBQSxTQUFBOztBQUFBLGVBQUEsU0FBQTtBQUFBLEtBQUEsQ0FBQSxZQXlCSjtBQUNQLGVBQU8sYUFBQSxrQkFBQSxFQUFQLFNBQU8sQ0FBUDtBQTFCVyxLQUFBLENBQUE7QUFBQSxVQUFBLFNBQUEsS0FBQSxHQTRCVDtBQUNGLGVBQU8sYUFBQSxhQUFBLEVBQVAsSUFBTyxDQUFQO0FBQ0Q7QUE5QlksQzs7QUFtQ2YsU0FBQSxPQUFBLENBQUEsSUFBQSxFQUF1RDtBQUNyRCxXQUFPLFVBQUEsS0FBQSxFQUEwQjtBQUMvQixlQUFPLGFBQUEsSUFBQSxFQUFQLEtBQU8sQ0FBUDtBQURGLEtBQUE7QUFHRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEFTVCBmcm9tICcuL3R5cGVzL25vZGVzJztcbmltcG9ydCB7IE9wdGlvbiwgRGljdCB9IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgZGVwcmVjYXRlLCBhc3NpZ24gfSBmcm9tICdAZ2xpbW1lci91dGlsJztcbmltcG9ydCB7IERFVk1PREUgfSBmcm9tICdAZ2xpbW1lci9sb2NhbC1kZWJ1Zy1mbGFncyc7XG5pbXBvcnQgeyBTdHJpbmdMaXRlcmFsLCBCb29sZWFuTGl0ZXJhbCwgTnVtYmVyTGl0ZXJhbCB9IGZyb20gJy4vdHlwZXMvaGFuZGxlYmFycy1hc3QnO1xuXG4vLyBTdGF0ZW1lbnRzXG5cbmV4cG9ydCB0eXBlIEJ1aWxkZXJQYXRoID0gc3RyaW5nIHwgQVNULlBhdGhFeHByZXNzaW9uO1xuZXhwb3J0IHR5cGUgVGFnRGVzY3JpcHRvciA9IHN0cmluZyB8IHsgbmFtZTogc3RyaW5nOyBzZWxmQ2xvc2luZzogYm9vbGVhbiB9O1xuXG5mdW5jdGlvbiBidWlsZE11c3RhY2hlKFxuICBwYXRoOiBCdWlsZGVyUGF0aCB8IEFTVC5MaXRlcmFsLFxuICBwYXJhbXM/OiBBU1QuRXhwcmVzc2lvbltdLFxuICBoYXNoPzogQVNULkhhc2gsXG4gIHJhdz86IGJvb2xlYW4sXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULk11c3RhY2hlU3RhdGVtZW50IHtcbiAgaWYgKHR5cGVvZiBwYXRoID09PSAnc3RyaW5nJykge1xuICAgIHBhdGggPSBidWlsZFBhdGgocGF0aCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHR5cGU6ICdNdXN0YWNoZVN0YXRlbWVudCcsXG4gICAgcGF0aCxcbiAgICBwYXJhbXM6IHBhcmFtcyB8fCBbXSxcbiAgICBoYXNoOiBoYXNoIHx8IGJ1aWxkSGFzaChbXSksXG4gICAgZXNjYXBlZDogIXJhdyxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRCbG9jayhcbiAgcGF0aDogQnVpbGRlclBhdGgsXG4gIHBhcmFtczogT3B0aW9uPEFTVC5FeHByZXNzaW9uW10+LFxuICBoYXNoOiBPcHRpb248QVNULkhhc2g+LFxuICBfZGVmYXVsdEJsb2NrOiBBU1QuUG9zc2libHlEZXByZWNhdGVkQmxvY2ssXG4gIF9lbHNlQmxvY2s/OiBPcHRpb248QVNULlBvc3NpYmx5RGVwcmVjYXRlZEJsb2NrPixcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uXG4pOiBBU1QuQmxvY2tTdGF0ZW1lbnQge1xuICBsZXQgZGVmYXVsdEJsb2NrOiBBU1QuQmxvY2s7XG4gIGxldCBlbHNlQmxvY2s6IE9wdGlvbjxBU1QuQmxvY2s+IHwgdW5kZWZpbmVkO1xuXG4gIGlmIChfZGVmYXVsdEJsb2NrLnR5cGUgPT09ICdUZW1wbGF0ZScpIHtcbiAgICBpZiAoREVWTU9ERSkge1xuICAgICAgZGVwcmVjYXRlKGBiLnByb2dyYW0gaXMgZGVwcmVjYXRlZC4gVXNlIGIuYmxvY2tJdHNlbGYgaW5zdGVhZC5gKTtcbiAgICB9XG5cbiAgICBkZWZhdWx0QmxvY2sgPSAoYXNzaWduKHt9LCBfZGVmYXVsdEJsb2NrLCB7IHR5cGU6ICdCbG9jaycgfSkgYXMgdW5rbm93bikgYXMgQVNULkJsb2NrO1xuICB9IGVsc2Uge1xuICAgIGRlZmF1bHRCbG9jayA9IF9kZWZhdWx0QmxvY2s7XG4gIH1cblxuICBpZiAoX2Vsc2VCbG9jayAhPT0gdW5kZWZpbmVkICYmIF9lbHNlQmxvY2sgIT09IG51bGwgJiYgX2Vsc2VCbG9jay50eXBlID09PSAnVGVtcGxhdGUnKSB7XG4gICAgaWYgKERFVk1PREUpIHtcbiAgICAgIGRlcHJlY2F0ZShgYi5wcm9ncmFtIGlzIGRlcHJlY2F0ZWQuIFVzZSBiLmJsb2NrSXRzZWxmIGluc3RlYWQuYCk7XG4gICAgfVxuXG4gICAgZWxzZUJsb2NrID0gKGFzc2lnbih7fSwgX2Vsc2VCbG9jaywgeyB0eXBlOiAnQmxvY2snIH0pIGFzIHVua25vd24pIGFzIEFTVC5CbG9jaztcbiAgfSBlbHNlIHtcbiAgICBlbHNlQmxvY2sgPSBfZWxzZUJsb2NrO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnQmxvY2tTdGF0ZW1lbnQnLFxuICAgIHBhdGg6IGJ1aWxkUGF0aChwYXRoKSxcbiAgICBwYXJhbXM6IHBhcmFtcyB8fCBbXSxcbiAgICBoYXNoOiBoYXNoIHx8IGJ1aWxkSGFzaChbXSksXG4gICAgcHJvZ3JhbTogZGVmYXVsdEJsb2NrIHx8IG51bGwsXG4gICAgaW52ZXJzZTogZWxzZUJsb2NrIHx8IG51bGwsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkRWxlbWVudE1vZGlmaWVyKFxuICBwYXRoOiBCdWlsZGVyUGF0aCxcbiAgcGFyYW1zPzogQVNULkV4cHJlc3Npb25bXSxcbiAgaGFzaD86IEFTVC5IYXNoLFxuICBsb2M/OiBPcHRpb248QVNULlNvdXJjZUxvY2F0aW9uPlxuKTogQVNULkVsZW1lbnRNb2RpZmllclN0YXRlbWVudCB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ0VsZW1lbnRNb2RpZmllclN0YXRlbWVudCcsXG4gICAgcGF0aDogYnVpbGRQYXRoKHBhdGgpLFxuICAgIHBhcmFtczogcGFyYW1zIHx8IFtdLFxuICAgIGhhc2g6IGhhc2ggfHwgYnVpbGRIYXNoKFtdKSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRQYXJ0aWFsKFxuICBuYW1lOiBBU1QuUGF0aEV4cHJlc3Npb24sXG4gIHBhcmFtcz86IEFTVC5FeHByZXNzaW9uW10sXG4gIGhhc2g/OiBBU1QuSGFzaCxcbiAgaW5kZW50Pzogc3RyaW5nLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5QYXJ0aWFsU3RhdGVtZW50IHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnUGFydGlhbFN0YXRlbWVudCcsXG4gICAgbmFtZTogbmFtZSxcbiAgICBwYXJhbXM6IHBhcmFtcyB8fCBbXSxcbiAgICBoYXNoOiBoYXNoIHx8IGJ1aWxkSGFzaChbXSksXG4gICAgaW5kZW50OiBpbmRlbnQgfHwgJycsXG4gICAgc3RyaXA6IHsgb3BlbjogZmFsc2UsIGNsb3NlOiBmYWxzZSB9LFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZENvbW1lbnQodmFsdWU6IHN0cmluZywgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkNvbW1lbnRTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdDb21tZW50U3RhdGVtZW50JyxcbiAgICB2YWx1ZTogdmFsdWUsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkTXVzdGFjaGVDb21tZW50KFxuICB2YWx1ZTogc3RyaW5nLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5NdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdNdXN0YWNoZUNvbW1lbnRTdGF0ZW1lbnQnLFxuICAgIHZhbHVlOiB2YWx1ZSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRDb25jYXQoXG4gIHBhcnRzOiAoQVNULlRleHROb2RlIHwgQVNULk11c3RhY2hlU3RhdGVtZW50KVtdLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IEFTVC5Db25jYXRTdGF0ZW1lbnQge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdDb25jYXRTdGF0ZW1lbnQnLFxuICAgIHBhcnRzOiBwYXJ0cyB8fCBbXSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuLy8gTm9kZXNcblxuZXhwb3J0IHR5cGUgRWxlbWVudEFyZ3MgPVxuICB8IFsnYXR0cnMnLCAuLi5BdHRyU2V4cFtdXVxuICB8IFsnbW9kaWZpZXJzJywgLi4uTW9kaWZpZXJTZXhwW11dXG4gIHwgWydib2R5JywgLi4uQVNULlN0YXRlbWVudFtdXVxuICB8IFsnY29tbWVudHMnLCAuLi5FbGVtZW50Q29tbWVudFtdXVxuICB8IFsnYXMnLCAuLi5zdHJpbmdbXV1cbiAgfCBbJ2xvYycsIEFTVC5Tb3VyY2VMb2NhdGlvbl07XG5cbmV4cG9ydCB0eXBlIFBhdGhTZXhwID0gc3RyaW5nIHwgWydwYXRoJywgc3RyaW5nLCBMb2NTZXhwP107XG5cbmV4cG9ydCB0eXBlIE1vZGlmaWVyU2V4cCA9XG4gIHwgc3RyaW5nXG4gIHwgW1BhdGhTZXhwLCBMb2NTZXhwP11cbiAgfCBbUGF0aFNleHAsIEFTVC5FeHByZXNzaW9uW10sIExvY1NleHA/XVxuICB8IFtQYXRoU2V4cCwgQVNULkV4cHJlc3Npb25bXSwgRGljdDxBU1QuRXhwcmVzc2lvbj4sIExvY1NleHA/XTtcblxuZXhwb3J0IHR5cGUgQXR0clNleHAgPSBbc3RyaW5nLCBBU1QuQXR0ck5vZGVbJ3ZhbHVlJ10gfCBzdHJpbmcsIExvY1NleHA/XTtcblxuZXhwb3J0IHR5cGUgTG9jU2V4cCA9IFsnbG9jJywgQVNULlNvdXJjZUxvY2F0aW9uXTtcblxuZXhwb3J0IHR5cGUgRWxlbWVudENvbW1lbnQgPSBBU1QuTXVzdGFjaGVDb21tZW50U3RhdGVtZW50IHwgQVNULlNvdXJjZUxvY2F0aW9uIHwgc3RyaW5nO1xuXG5leHBvcnQgdHlwZSBTZXhwVmFsdWUgPVxuICB8IHN0cmluZ1xuICB8IEFTVC5FeHByZXNzaW9uW11cbiAgfCBEaWN0PEFTVC5FeHByZXNzaW9uPlxuICB8IExvY1NleHBcbiAgfCBQYXRoU2V4cFxuICB8IHVuZGVmaW5lZDtcblxuZXhwb3J0IGZ1bmN0aW9uIGlzTG9jU2V4cCh2YWx1ZTogU2V4cFZhbHVlKTogdmFsdWUgaXMgTG9jU2V4cCB7XG4gIHJldHVybiBBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDIgJiYgdmFsdWVbMF0gPT09ICdsb2MnO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNQYXJhbXNTZXhwKHZhbHVlOiBTZXhwVmFsdWUpOiB2YWx1ZSBpcyBBU1QuRXhwcmVzc2lvbltdIHtcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpICYmICFpc0xvY1NleHAodmFsdWUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNIYXNoU2V4cCh2YWx1ZTogU2V4cFZhbHVlKTogdmFsdWUgaXMgRGljdDxBU1QuRXhwcmVzc2lvbj4ge1xuICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiAhQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICBleHBlY3RUeXBlPERpY3Q8QVNULkV4cHJlc3Npb24+Pih2YWx1ZSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGV4cGVjdFR5cGU8VD4oX2lucHV0OiBUKTogdm9pZCB7XG4gIHJldHVybjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZU1vZGlmaWVyKHNleHA6IE1vZGlmaWVyU2V4cCk6IEFTVC5FbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnQge1xuICBpZiAodHlwZW9mIHNleHAgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGJ1aWxkRWxlbWVudE1vZGlmaWVyKHNleHApO1xuICB9XG5cbiAgbGV0IHBhdGg6IEFTVC5QYXRoRXhwcmVzc2lvbiA9IG5vcm1hbGl6ZVBhdGgoc2V4cFswXSk7XG4gIGxldCBwYXJhbXM6IEFTVC5FeHByZXNzaW9uW10gfCB1bmRlZmluZWQ7XG4gIGxldCBoYXNoOiBBU1QuSGFzaCB8IHVuZGVmaW5lZDtcbiAgbGV0IGxvYzogQVNULlNvdXJjZUxvY2F0aW9uIHwgbnVsbCA9IG51bGw7XG5cbiAgbGV0IHBhcnRzID0gc2V4cC5zbGljZSgxKTtcbiAgbGV0IG5leHQgPSBwYXJ0cy5zaGlmdCgpO1xuXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpsYWJlbC1wb3NpdGlvblxuICBwcm9jZXNzOiB7XG4gICAgaWYgKGlzUGFyYW1zU2V4cChuZXh0KSkge1xuICAgICAgcGFyYW1zID0gbmV4dCBhcyBBU1QuRXhwcmVzc2lvbltdO1xuICAgIH0gZWxzZSB7XG4gICAgICBicmVhayBwcm9jZXNzO1xuICAgIH1cblxuICAgIG5leHQgPSBwYXJ0cy5zaGlmdCgpO1xuXG4gICAgaWYgKGlzSGFzaFNleHAobmV4dCkpIHtcbiAgICAgIGhhc2ggPSBub3JtYWxpemVIYXNoKG5leHQgYXMgRGljdDxBU1QuRXhwcmVzc2lvbj4pO1xuICAgIH0gZWxzZSB7XG4gICAgICBicmVhayBwcm9jZXNzO1xuICAgIH1cbiAgfVxuXG4gIGlmIChpc0xvY1NleHAobmV4dCkpIHtcbiAgICBsb2MgPSBuZXh0WzFdO1xuICB9XG5cbiAgcmV0dXJuIGJ1aWxkRWxlbWVudE1vZGlmaWVyKHBhdGgsIHBhcmFtcywgaGFzaCwgbG9jKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUF0dHIoc2V4cDogQXR0clNleHApOiBBU1QuQXR0ck5vZGUge1xuICBsZXQgbmFtZSA9IHNleHBbMF07XG4gIGxldCB2YWx1ZTtcblxuICBpZiAodHlwZW9mIHNleHBbMV0gPT09ICdzdHJpbmcnKSB7XG4gICAgdmFsdWUgPSBidWlsZFRleHQoc2V4cFsxXSk7XG4gIH0gZWxzZSB7XG4gICAgdmFsdWUgPSBzZXhwWzFdO1xuICB9XG5cbiAgbGV0IGxvYyA9IHNleHBbMl0gPyBzZXhwWzJdWzFdIDogdW5kZWZpbmVkO1xuXG4gIHJldHVybiBidWlsZEF0dHIobmFtZSwgdmFsdWUsIGxvYyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVIYXNoKGhhc2g6IERpY3Q8QVNULkV4cHJlc3Npb24+LCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuSGFzaCB7XG4gIGxldCBwYWlyczogQVNULkhhc2hQYWlyW10gPSBbXTtcblxuICBPYmplY3Qua2V5cyhoYXNoKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgcGFpcnMucHVzaChidWlsZFBhaXIoa2V5LCBoYXNoW2tleV0pKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGJ1aWxkSGFzaChwYWlycywgbG9jKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZVBhdGgocGF0aDogUGF0aFNleHApOiBBU1QuUGF0aEV4cHJlc3Npb24ge1xuICBpZiAodHlwZW9mIHBhdGggPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGJ1aWxkUGF0aChwYXRoKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYnVpbGRQYXRoKHBhdGhbMV0sIHBhdGhbMl0gJiYgcGF0aFsyXVsxXSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUVsZW1lbnRPcHRpb25zKC4uLmFyZ3M6IEVsZW1lbnRBcmdzW10pOiBCdWlsZEVsZW1lbnRPcHRpb25zIHtcbiAgbGV0IG91dDogQnVpbGRFbGVtZW50T3B0aW9ucyA9IHt9O1xuXG4gIGZvciAobGV0IGFyZyBvZiBhcmdzKSB7XG4gICAgc3dpdGNoIChhcmdbMF0pIHtcbiAgICAgIGNhc2UgJ2F0dHJzJzoge1xuICAgICAgICBsZXQgWywgLi4ucmVzdF0gPSBhcmc7XG4gICAgICAgIG91dC5hdHRycyA9IHJlc3QubWFwKG5vcm1hbGl6ZUF0dHIpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgJ21vZGlmaWVycyc6IHtcbiAgICAgICAgbGV0IFssIC4uLnJlc3RdID0gYXJnO1xuICAgICAgICBvdXQubW9kaWZpZXJzID0gcmVzdC5tYXAobm9ybWFsaXplTW9kaWZpZXIpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgJ2JvZHknOiB7XG4gICAgICAgIGxldCBbLCAuLi5yZXN0XSA9IGFyZztcbiAgICAgICAgb3V0LmNoaWxkcmVuID0gcmVzdDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlICdjb21tZW50cyc6IHtcbiAgICAgICAgbGV0IFssIC4uLnJlc3RdID0gYXJnO1xuXG4gICAgICAgIG91dC5jb21tZW50cyA9IHJlc3Q7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSAnYXMnOiB7XG4gICAgICAgIGxldCBbLCAuLi5yZXN0XSA9IGFyZztcbiAgICAgICAgb3V0LmJsb2NrUGFyYW1zID0gcmVzdDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlICdsb2MnOiB7XG4gICAgICAgIGxldCBbLCByZXN0XSA9IGFyZztcbiAgICAgICAgb3V0LmxvYyA9IHJlc3Q7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvdXQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQnVpbGRFbGVtZW50T3B0aW9ucyB7XG4gIGF0dHJzPzogQVNULkF0dHJOb2RlW107XG4gIG1vZGlmaWVycz86IEFTVC5FbGVtZW50TW9kaWZpZXJTdGF0ZW1lbnRbXTtcbiAgY2hpbGRyZW4/OiBBU1QuU3RhdGVtZW50W107XG4gIGNvbW1lbnRzPzogRWxlbWVudENvbW1lbnRbXTtcbiAgYmxvY2tQYXJhbXM/OiBzdHJpbmdbXTtcbiAgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uO1xufVxuXG5mdW5jdGlvbiBidWlsZEVsZW1lbnQodGFnOiBUYWdEZXNjcmlwdG9yLCBvcHRpb25zPzogQnVpbGRFbGVtZW50T3B0aW9ucyk6IEFTVC5FbGVtZW50Tm9kZTtcbmZ1bmN0aW9uIGJ1aWxkRWxlbWVudCh0YWc6IFRhZ0Rlc2NyaXB0b3IsIC4uLm9wdGlvbnM6IEVsZW1lbnRBcmdzW10pOiBBU1QuRWxlbWVudE5vZGU7XG5mdW5jdGlvbiBidWlsZEVsZW1lbnQoXG4gIHRhZzogVGFnRGVzY3JpcHRvcixcbiAgb3B0aW9ucz86IEJ1aWxkRWxlbWVudE9wdGlvbnMgfCBFbGVtZW50QXJncyxcbiAgLi4ucmVzdDogRWxlbWVudEFyZ3NbXVxuKTogQVNULkVsZW1lbnROb2RlIHtcbiAgbGV0IG5vcm1hbGl6ZWQ6IEJ1aWxkRWxlbWVudE9wdGlvbnM7XG4gIGlmIChBcnJheS5pc0FycmF5KG9wdGlvbnMpKSB7XG4gICAgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZUVsZW1lbnRPcHRpb25zKG9wdGlvbnMsIC4uLnJlc3QpO1xuICB9IGVsc2Uge1xuICAgIG5vcm1hbGl6ZWQgPSBvcHRpb25zIHx8IHt9O1xuICB9XG5cbiAgbGV0IHsgYXR0cnMsIGJsb2NrUGFyYW1zLCBtb2RpZmllcnMsIGNvbW1lbnRzLCBjaGlsZHJlbiwgbG9jIH0gPSBub3JtYWxpemVkO1xuXG4gIC8vIHRoaXMgaXMgdXNlZCBmb3IgYmFja3dhcmRzIGNvbXBhdCwgcHJpb3IgdG8gYHNlbGZDbG9zaW5nYCBiZWluZyBwYXJ0IG9mIHRoZSBFbGVtZW50Tm9kZSBBU1RcbiAgbGV0IHNlbGZDbG9zaW5nID0gZmFsc2U7XG4gIGlmICh0eXBlb2YgdGFnID09PSAnb2JqZWN0Jykge1xuICAgIHNlbGZDbG9zaW5nID0gdGFnLnNlbGZDbG9zaW5nO1xuICAgIHRhZyA9IHRhZy5uYW1lO1xuICB9IGVsc2Uge1xuICAgIGlmICh0YWcuc2xpY2UoLTEpID09PSAnLycpIHtcbiAgICAgIHRhZyA9IHRhZy5zbGljZSgwLCAtMSk7XG4gICAgICBzZWxmQ2xvc2luZyA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnRWxlbWVudE5vZGUnLFxuICAgIHRhZzogdGFnIHx8ICcnLFxuICAgIHNlbGZDbG9zaW5nOiBzZWxmQ2xvc2luZyxcbiAgICBhdHRyaWJ1dGVzOiBhdHRycyB8fCBbXSxcbiAgICBibG9ja1BhcmFtczogYmxvY2tQYXJhbXMgfHwgW10sXG4gICAgbW9kaWZpZXJzOiBtb2RpZmllcnMgfHwgW10sXG4gICAgY29tbWVudHM6IChjb21tZW50cyBhcyBBU1QuTXVzdGFjaGVDb21tZW50U3RhdGVtZW50W10pIHx8IFtdLFxuICAgIGNoaWxkcmVuOiBjaGlsZHJlbiB8fCBbXSxcbiAgICBsb2M6IGJ1aWxkTG9jKGxvYyB8fCBudWxsKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRBdHRyKFxuICBuYW1lOiBzdHJpbmcsXG4gIHZhbHVlOiBBU1QuQXR0ck5vZGVbJ3ZhbHVlJ10sXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULkF0dHJOb2RlIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnQXR0ck5vZGUnLFxuICAgIG5hbWU6IG5hbWUsXG4gICAgdmFsdWU6IHZhbHVlLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFRleHQoY2hhcnM/OiBzdHJpbmcsIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5UZXh0Tm9kZSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ1RleHROb2RlJyxcbiAgICBjaGFyczogY2hhcnMgfHwgJycsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbi8vIEV4cHJlc3Npb25zXG5cbmZ1bmN0aW9uIGJ1aWxkU2V4cHIoXG4gIHBhdGg6IEJ1aWxkZXJQYXRoLFxuICBwYXJhbXM/OiBBU1QuRXhwcmVzc2lvbltdLFxuICBoYXNoPzogQVNULkhhc2gsXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULlN1YkV4cHJlc3Npb24ge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdTdWJFeHByZXNzaW9uJyxcbiAgICBwYXRoOiBidWlsZFBhdGgocGF0aCksXG4gICAgcGFyYW1zOiBwYXJhbXMgfHwgW10sXG4gICAgaGFzaDogaGFzaCB8fCBidWlsZEhhc2goW10pLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFBhdGgob3JpZ2luYWw6IEJ1aWxkZXJQYXRoLCBsb2M/OiBBU1QuU291cmNlTG9jYXRpb24pOiBBU1QuUGF0aEV4cHJlc3Npb24ge1xuICBpZiAodHlwZW9mIG9yaWdpbmFsICE9PSAnc3RyaW5nJykgcmV0dXJuIG9yaWdpbmFsO1xuXG4gIGxldCBwYXJ0cyA9IG9yaWdpbmFsLnNwbGl0KCcuJyk7XG4gIGxldCB0aGlzSGVhZCA9IGZhbHNlO1xuXG4gIGlmIChwYXJ0c1swXSA9PT0gJ3RoaXMnKSB7XG4gICAgdGhpc0hlYWQgPSB0cnVlO1xuICAgIHBhcnRzID0gcGFydHMuc2xpY2UoMSk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHR5cGU6ICdQYXRoRXhwcmVzc2lvbicsXG4gICAgb3JpZ2luYWwsXG4gICAgdGhpczogdGhpc0hlYWQsXG4gICAgcGFydHMsXG4gICAgZGF0YTogZmFsc2UsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkTGl0ZXJhbDxUIGV4dGVuZHMgQVNULkxpdGVyYWw+KFxuICB0eXBlOiBUWyd0eXBlJ10sXG4gIHZhbHVlOiBUWyd2YWx1ZSddLFxuICBsb2M/OiBBU1QuU291cmNlTG9jYXRpb25cbik6IFQge1xuICByZXR1cm4ge1xuICAgIHR5cGUsXG4gICAgdmFsdWUsXG4gICAgb3JpZ2luYWw6IHZhbHVlLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9IGFzIFQ7XG59XG5cbi8vIE1pc2NlbGxhbmVvdXNcblxuZnVuY3Rpb24gYnVpbGRIYXNoKHBhaXJzPzogQVNULkhhc2hQYWlyW10sIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvbik6IEFTVC5IYXNoIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnSGFzaCcsXG4gICAgcGFpcnM6IHBhaXJzIHx8IFtdLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFBhaXIoa2V5OiBzdHJpbmcsIHZhbHVlOiBBU1QuRXhwcmVzc2lvbiwgbG9jPzogQVNULlNvdXJjZUxvY2F0aW9uKTogQVNULkhhc2hQYWlyIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnSGFzaFBhaXInLFxuICAgIGtleToga2V5LFxuICAgIHZhbHVlLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFByb2dyYW0oXG4gIGJvZHk/OiBBU1QuU3RhdGVtZW50W10sXG4gIGJsb2NrUGFyYW1zPzogc3RyaW5nW10sXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULlRlbXBsYXRlIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnVGVtcGxhdGUnLFxuICAgIGJvZHk6IGJvZHkgfHwgW10sXG4gICAgYmxvY2tQYXJhbXM6IGJsb2NrUGFyYW1zIHx8IFtdLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZEJsb2NrSXRzZWxmKFxuICBib2R5PzogQVNULlN0YXRlbWVudFtdLFxuICBibG9ja1BhcmFtcz86IHN0cmluZ1tdLFxuICBjaGFpbmVkID0gZmFsc2UsXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULkJsb2NrIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnQmxvY2snLFxuICAgIGJvZHk6IGJvZHkgfHwgW10sXG4gICAgYmxvY2tQYXJhbXM6IGJsb2NrUGFyYW1zIHx8IFtdLFxuICAgIGNoYWluZWQsXG4gICAgbG9jOiBidWlsZExvYyhsb2MgfHwgbnVsbCksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGJ1aWxkVGVtcGxhdGUoXG4gIGJvZHk/OiBBU1QuU3RhdGVtZW50W10sXG4gIGJsb2NrUGFyYW1zPzogc3RyaW5nW10sXG4gIGxvYz86IEFTVC5Tb3VyY2VMb2NhdGlvblxuKTogQVNULlRlbXBsYXRlIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnVGVtcGxhdGUnLFxuICAgIGJvZHk6IGJvZHkgfHwgW10sXG4gICAgYmxvY2tQYXJhbXM6IGJsb2NrUGFyYW1zIHx8IFtdLFxuICAgIGxvYzogYnVpbGRMb2MobG9jIHx8IG51bGwpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFNvdXJjZShzb3VyY2U/OiBzdHJpbmcpIHtcbiAgcmV0dXJuIHNvdXJjZSB8fCBudWxsO1xufVxuXG5mdW5jdGlvbiBidWlsZFBvc2l0aW9uKGxpbmU6IG51bWJlciwgY29sdW1uOiBudW1iZXIpIHtcbiAgcmV0dXJuIHtcbiAgICBsaW5lLFxuICAgIGNvbHVtbixcbiAgfTtcbn1cblxuZXhwb3J0IGNvbnN0IFNZTlRIRVRJQzogQVNULlNvdXJjZUxvY2F0aW9uID0ge1xuICBzb3VyY2U6ICcoc3ludGhldGljKScsXG4gIHN0YXJ0OiB7IGxpbmU6IDEsIGNvbHVtbjogMCB9LFxuICBlbmQ6IHsgbGluZTogMSwgY29sdW1uOiAwIH0sXG59O1xuXG5mdW5jdGlvbiBidWlsZExvYyhsb2M6IE9wdGlvbjxBU1QuU291cmNlTG9jYXRpb24+KTogQVNULlNvdXJjZUxvY2F0aW9uO1xuZnVuY3Rpb24gYnVpbGRMb2MoXG4gIHN0YXJ0TGluZTogbnVtYmVyLFxuICBzdGFydENvbHVtbjogbnVtYmVyLFxuICBlbmRMaW5lPzogbnVtYmVyLFxuICBlbmRDb2x1bW4/OiBudW1iZXIsXG4gIHNvdXJjZT86IHN0cmluZ1xuKTogQVNULlNvdXJjZUxvY2F0aW9uO1xuXG5mdW5jdGlvbiBidWlsZExvYyguLi5hcmdzOiBhbnlbXSk6IEFTVC5Tb3VyY2VMb2NhdGlvbiB7XG4gIGlmIChhcmdzLmxlbmd0aCA9PT0gMSkge1xuICAgIGxldCBsb2MgPSBhcmdzWzBdO1xuXG4gICAgaWYgKGxvYyAmJiB0eXBlb2YgbG9jID09PSAnb2JqZWN0Jykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc291cmNlOiBidWlsZFNvdXJjZShsb2Muc291cmNlKSxcbiAgICAgICAgc3RhcnQ6IGJ1aWxkUG9zaXRpb24obG9jLnN0YXJ0LmxpbmUsIGxvYy5zdGFydC5jb2x1bW4pLFxuICAgICAgICBlbmQ6IGJ1aWxkUG9zaXRpb24obG9jLmVuZC5saW5lLCBsb2MuZW5kLmNvbHVtbiksXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gU1lOVEhFVElDO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsZXQgW3N0YXJ0TGluZSwgc3RhcnRDb2x1bW4sIGVuZExpbmUsIGVuZENvbHVtbiwgc291cmNlXSA9IGFyZ3M7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNvdXJjZTogYnVpbGRTb3VyY2Uoc291cmNlKSxcbiAgICAgIHN0YXJ0OiBidWlsZFBvc2l0aW9uKHN0YXJ0TGluZSwgc3RhcnRDb2x1bW4pLFxuICAgICAgZW5kOiBidWlsZFBvc2l0aW9uKGVuZExpbmUsIGVuZENvbHVtbiksXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIG11c3RhY2hlOiBidWlsZE11c3RhY2hlLFxuICBibG9jazogYnVpbGRCbG9jayxcbiAgcGFydGlhbDogYnVpbGRQYXJ0aWFsLFxuICBjb21tZW50OiBidWlsZENvbW1lbnQsXG4gIG11c3RhY2hlQ29tbWVudDogYnVpbGRNdXN0YWNoZUNvbW1lbnQsXG4gIGVsZW1lbnQ6IGJ1aWxkRWxlbWVudCxcbiAgZWxlbWVudE1vZGlmaWVyOiBidWlsZEVsZW1lbnRNb2RpZmllcixcbiAgYXR0cjogYnVpbGRBdHRyLFxuICB0ZXh0OiBidWlsZFRleHQsXG4gIHNleHByOiBidWlsZFNleHByLFxuICBwYXRoOiBidWlsZFBhdGgsXG4gIGNvbmNhdDogYnVpbGRDb25jYXQsXG4gIGhhc2g6IGJ1aWxkSGFzaCxcbiAgcGFpcjogYnVpbGRQYWlyLFxuICBsaXRlcmFsOiBidWlsZExpdGVyYWwsXG4gIHByb2dyYW06IGJ1aWxkUHJvZ3JhbSxcbiAgYmxvY2tJdHNlbGY6IGJ1aWxkQmxvY2tJdHNlbGYsXG4gIHRlbXBsYXRlOiBidWlsZFRlbXBsYXRlLFxuICBsb2M6IGJ1aWxkTG9jLFxuICBwb3M6IGJ1aWxkUG9zaXRpb24sXG5cbiAgc3RyaW5nOiBsaXRlcmFsKCdTdHJpbmdMaXRlcmFsJykgYXMgKHZhbHVlOiBzdHJpbmcpID0+IFN0cmluZ0xpdGVyYWwsXG4gIGJvb2xlYW46IGxpdGVyYWwoJ0Jvb2xlYW5MaXRlcmFsJykgYXMgKHZhbHVlOiBib29sZWFuKSA9PiBCb29sZWFuTGl0ZXJhbCxcbiAgbnVtYmVyOiBsaXRlcmFsKCdOdW1iZXJMaXRlcmFsJykgYXMgKHZhbHVlOiBudW1iZXIpID0+IE51bWJlckxpdGVyYWwsXG4gIHVuZGVmaW5lZCgpIHtcbiAgICByZXR1cm4gYnVpbGRMaXRlcmFsKCdVbmRlZmluZWRMaXRlcmFsJywgdW5kZWZpbmVkKTtcbiAgfSxcbiAgbnVsbCgpIHtcbiAgICByZXR1cm4gYnVpbGRMaXRlcmFsKCdOdWxsTGl0ZXJhbCcsIG51bGwpO1xuICB9LFxufTtcblxudHlwZSBCdWlsZExpdGVyYWw8VCBleHRlbmRzIEFTVC5MaXRlcmFsPiA9ICh2YWx1ZTogVFsndmFsdWUnXSkgPT4gVDtcblxuZnVuY3Rpb24gbGl0ZXJhbDxUIGV4dGVuZHMgQVNULkxpdGVyYWw+KHR5cGU6IFRbJ3R5cGUnXSk6IEJ1aWxkTGl0ZXJhbDxUPiB7XG4gIHJldHVybiBmdW5jdGlvbih2YWx1ZTogVFsndmFsdWUnXSk6IFQge1xuICAgIHJldHVybiBidWlsZExpdGVyYWwodHlwZSwgdmFsdWUpO1xuICB9O1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==